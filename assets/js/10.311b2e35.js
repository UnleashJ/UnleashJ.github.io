(window.webpackJsonp=window.webpackJsonp||[]).push([[10],{556:function(t,s,a){t.exports=a.p+"assets/img/processesOfBrowser.6308cf75.svg"},557:function(t,s,a){t.exports=a.p+"assets/img/browserKernel.9e801e5a.svg"},558:function(t,s,a){t.exports=a.p+"assets/img/eventLoop1.135dc840.svg"},559:function(t,s,a){t.exports=a.p+"assets/img/eventLoop2.13e6dcd3.svg"},582:function(t,s,a){"use strict";a.r(s);var n=a(16),e=Object(n.a)({},(function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[n("p",[t._v("  学习到Vue"),n("code",[t._v("vm.$nextTick")]),t._v("API时，对JavaScript事件循环有了一定的了解。借此机会对JS运行机制进行一次总结，以便更好地理解"),n("code",[t._v("vm.$nextTick")]),t._v("API源码。并对异步任务、浏览器事件循环有更深入的认识，形成知识体系。")]),t._v(" "),n("h2",{attrs:{id:"浏览器的进程与线程"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#浏览器的进程与线程"}},[t._v("#")]),t._v(" 浏览器的进程与线程")]),t._v(" "),n("p",[t._v("  进程是cpu资源分配的最小单位（是能拥有资源和独立运行的最小单位）。线程是cpu调度的最小单位（线程是建立在进程的基础上的一次程序运行单位，一个进程中可以有多个线程）。一般所指的单线程与多线程都是一个进程内的单和多。")]),t._v(" "),n("p",[t._v("  浏览器是多进程的，通俗的讲，每打开一个Tab页，就相当于创建了一个独立的浏览器进程。浏览器的主要进程有：")]),t._v(" "),n("p",[n("img",{attrs:{src:a(556),alt:""}})]),t._v(" "),n("p",[t._v("  重点是浏览器渲染进程，页面的渲染，JS的执行，事件的循环，都在这个进程内进行。它是多线程的，主要包括以下线程。"),n("strong",[t._v("GUI渲染线程与JS引擎线程是互斥的")]),t._v("，由于JavaScript是可操纵DOM的，如果在修改这些元素属性同时渲染界面（即JS线程和UI线程同时运行），那么渲染线程前后获得的元素数据就可能不一致了。所以如果JS执行的时间过长，这样就会造成页面的渲染不连贯，导致页面渲染加载阻塞。")]),t._v(" "),n("ol",[n("li",[t._v("GUI渲染进程主要负责渲染浏览器页面。")]),t._v(" "),n("li",[t._v("JS引擎线程也成为JS内核，负责处理JavaScript脚本程序。\n"),n("ol",[n("li",[t._v("一个Tab页（renderer进程）中无论什么时候都只有一个JS线程在运行JS程序。")]),t._v(" "),n("li",[n("strong",[t._v("GUI渲染线程与JS引擎线程是互斥的")]),t._v("。")])])]),t._v(" "),n("li",[t._v("事件触发线程，归属于浏览器而不是JS引擎，用来控制事件循环。")]),t._v(" "),n("li",[t._v("定时触发器线程，"),n("code",[t._v("setInterval")]),t._v("与"),n("code",[t._v("setTimeout")]),t._v("所在线程。")]),t._v(" "),n("li",[t._v("异步http请求线程，ajax在连接后是通过浏览器新开一个线程请求")])]),t._v(" "),n("p",[n("img",{attrs:{src:a(557),alt:""}})]),t._v(" "),n("h2",{attrs:{id:"事件循环"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#事件循环"}},[t._v("#")]),t._v(" 事件循环")]),t._v(" "),n("p",[t._v("  介绍完基础知识之后，我们从事件循环的角度看一下JS代码时如何执行的。")]),t._v(" "),n("p",[t._v("  JS分为同步任务与异步任务，同步任务在主线程（即JS引擎线程）运行，形成一个执行栈。事件触发线程管理着一个"),n("strong",[t._v("任务队列")]),t._v("，只要异步任务有了运行结果，就向任务队列中放置一个事件（即事件的回调函数，只是放入但并没有执行）。一旦执行栈中同步任务执行完毕，就会读取任务队列，将头部任务添加到执行栈中开始执行。")]),t._v(" "),n("p",[t._v("  如下面这个例子，执行栈中依次执行"),n("code",[t._v("time()")]),t._v("、"),n("code",[t._v("event()")]),t._v("、"),n("code",[t._v("query()")]),t._v("方法（无论这三个函数是严格的依次执行还是嵌套执行）。在"),n("code",[t._v("time()")]),t._v("中调用"),n("code",[t._v("setTimeout()")]),t._v("延时API，在指定时间间隔之后（由定时器触发线程计时），定时器触发线程会将回调函数callback1添加到由事件触发线程管理的任务队列中。接着执行event()时，该方法监听了某个DOM事件，当事件发生时，将事件监听的回调函数callback2添加到任务队列中。最后执行"),n("code",[t._v("query()")]),t._v("，该方法发送了AJAX异步请求，在请求响应时，将回调函数callback3添加到任务队列中。此时执行栈为空，JS引擎线程从任务队列中读取队头任务callback1，放入执行栈中执行，执行完毕后，此时执行栈又为空，再从任务队列头部获取任务callback2。同理执行callback3。")]),t._v(" "),n("p",[n("img",{attrs:{src:a(558),alt:""}})]),t._v(" "),n("h2",{attrs:{id:"宏任务与微任务"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#宏任务与微任务"}},[t._v("#")]),t._v(" 宏任务与微任务")]),t._v(" "),n("p",[t._v("  ES6中新增了宏任务与微任务的概念。JS分为两种任务类型，"),n("strong",[n("code",[t._v("macrotask")]),t._v("和"),n("code",[t._v("microtask")])]),t._v("，在ECMAScript中，"),n("code",[t._v("microtask")]),t._v("称为"),n("code",[t._v("jobs")]),t._v("，"),n("code",[t._v("macrotask")]),t._v("可称为"),n("code",[t._v("task")]),t._v("。"),n("code",[t._v("macrotask")]),t._v("（又称之为宏任务），可以理解是每次执行栈执行的代码就是一个宏任务（包括每次从事件队列中获取一个事件回调并放到执行栈中执行）。浏览器为了能够使得JS内部task与DOM任务能够有序的执行，会在一个task执行结束后，在下一个 task 执行开始前，对页面进行重新渲染。"),n("code",[t._v("microtask")]),t._v("（又称为微任务），可以理解是在当前 task 执行结束后（页面渲染前）立即执行的任务。"),n("code",[t._v("microtask")]),t._v("中的所有微任务都是添加到微任务队列（Job Queues）中，等待当前"),n("code",[t._v("macrotask")]),t._v("执行完毕后执行，而这个队列由"),n("strong",[t._v("JS引擎线程维护")]),t._v("。")]),t._v(" "),n("p",[n("img",{attrs:{src:a(559),alt:""}})]),t._v(" "),n("p",[t._v("属于微任务的事件主要包括")]),t._v(" "),n("ul",[n("li",[t._v("Promise.then")]),t._v(" "),n("li",[t._v("MutationObserver")]),t._v(" "),n("li",[t._v("Object.observe")]),t._v(" "),n("li",[t._v("process.nextTick(Nodejs环境中)")])]),t._v(" "),n("p",[t._v("属于宏任务的事件主要包括")]),t._v(" "),n("ul",[n("li",[t._v("setTimeout")]),t._v(" "),n("li",[t._v("setInterval")]),t._v(" "),n("li",[t._v("setImmediate")]),t._v(" "),n("li",[t._v("MessageChannel")]),t._v(" "),n("li",[t._v("requestAnimationFrame")]),t._v(" "),n("li",[t._v("I/O")]),t._v(" "),n("li",[t._v("UI交互事件")])]),t._v(" "),n("div",{staticClass:"language-js extra-class"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[t._v("console"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'script start'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("setTimeout")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    console"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'setTimeout'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nPromise"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("resolve")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("then")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    console"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'promise1'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("then")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    console"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'promise2'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nconsole"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'script end'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n\nscript start\nscript end\npromise1\npromise2\nsetTimeout\n")])])])])}),[],!1,null,null,null);s.default=e.exports}}]);